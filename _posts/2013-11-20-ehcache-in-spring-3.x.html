---
layout: post
status: publish
published: true
title: 在Spring 3.x 中使用ehcache
author: Doni
author_login: D
author_email: donilan.word@gmail.com
wordpress_id: 351
wordpress_url: http://d.ii2d.com/?p=351
date: '2013-11-20 09:32:19 +0800'
date_gmt: '2013-11-20 09:32:19 +0800'
categories:
- JAVA
- Spring
tags:
- JAVA
- Spring
- EhCache
comments: []
---
<p>maven pom.xml依赖配置
[xml]
<dependency>
	<groupId>javax.transaction<&#47;groupId>
	<artifactId>jta<&#47;artifactId>
	<version>1.1<&#47;version>
<&#47;dependency>
<dependency>
	<groupId>net.sf.ehcache<&#47;groupId>
	<artifactId>ehcache<&#47;artifactId>
	<version>2.7.4<&#47;version>
<&#47;dependency>
[&#47;xml]</p>
<p>ehcache.xml配置
[xml]
<?xml version="1.0" encoding="UTF-8"?>
<ehcache xmlns:xsi="http:&#47;&#47;www.w3.org&#47;2001&#47;XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http:&#47;&#47;ehcache.org&#47;ehcache.xsd"
	updateCheck="false"></p>
<p>	<diskStore path="java.io.tmpdir&#47;EhCacheSpringAnnotationsExampleApp" &#47;></p>
<p>	<defaultCache eternal="false" maxElementsInMemory="1000"
		overflowToDisk="false" diskPersistent="false" timeToIdleSeconds="0"
		timeToLiveSeconds="10" memoryStoreEvictionPolicy="LRU" &#47;></p>
<p>	<cache name="tenSecond" eternal="false" maxElementsInMemory="1000"
		overflowToDisk="false" diskPersistent="false" timeToIdleSeconds="0"
		timeToLiveSeconds="10" memoryStoreEvictionPolicy="LRU" &#47;></p>
<p>	<cache name="oneMin" eternal="false" maxElementsInMemory="1000"
		overflowToDisk="false" diskPersistent="false" timeToIdleSeconds="0"
		timeToLiveSeconds="60" memoryStoreEvictionPolicy="LRU" &#47;></p>
<p>	<cache name="oneHour" eternal="false" maxElementsInMemory="1000"
		overflowToDisk="false" diskPersistent="false" timeToIdleSeconds="0"
		timeToLiveSeconds="3600" memoryStoreEvictionPolicy="LRU" &#47;>
<&#47;ehcache>
[&#47;xml]</p>
<p>spring配置
[xml]
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http:&#47;&#47;www.springframework.org&#47;schema&#47;beans"
	xmlns:xsi="http:&#47;&#47;www.w3.org&#47;2001&#47;XMLSchema-instance" xmlns:context="http:&#47;&#47;www.springframework.org&#47;schema&#47;context"
	xmlns:aop="http:&#47;&#47;www.springframework.org&#47;schema&#47;aop"
	xmlns:p="http:&#47;&#47;www.springframework.org&#47;schema&#47;p"
	xmlns:cache="http:&#47;&#47;www.springframework.org&#47;schema&#47;cache"</p>
<p>	xsi:schemaLocation="http:&#47;&#47;www.springframework.org&#47;schema&#47;beans
        http:&#47;&#47;www.springframework.org&#47;schema&#47;beans&#47;spring-beans-3.0.xsd
        http:&#47;&#47;www.springframework.org&#47;schema&#47;context
        http:&#47;&#47;www.springframework.org&#47;schema&#47;context&#47;spring-context-3.0.xsd
        http:&#47;&#47;www.springframework.org&#47;schema&#47;cache
        http:&#47;&#47;www.springframework.org&#47;schema&#47;cache&#47;spring-cache.xsd"></p>
<p>	<cache:annotation-driven &#47;>
	<bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager"
             p:cache-manager-ref="ehcache"&#47;>
	<!-- EhCache library setup -->
	<bean id="ehcache" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean"
             p:config-location="classpath:ehcache.xml" p:shared="true"&#47;>
	 <bean class="com.ii2d.CacheBean" &#47;>
<&#47;beans>
[&#47;xml]
测试类
[java]
package com.ii2d;</p>
<p>import org.springframework.cache.annotation.Cacheable;</p>
<p>public class CacheBean {</p>
<p>	static int val = 0;</p>
<p>	@Cacheable("tenSecond") public int method4test(int id) {
		return val++;
	}</p>
<p>}</p>
<p>[&#47;java]</p>
<p>单元测试
[java]
package com.ii2d;</p>
<p>import java.util.Random;</p>
<p>import javax.annotation.Resource;</p>
<p>import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</p>
<p>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:com&#47;createw&#47;acc&#47;cache&#47;application-context.xml")
public class EhCacheTests {</p>
<p>	@Resource CacheBean cacheBean;</p>
<p>	@Test
	public void testCache() throws InterruptedException {
		Random r = new Random(System.currentTimeMillis());
		for(int i = 0; i < 100; ++i) {
			int id = r.nextInt(3);
			System.out.printf("Id: %d, value: %d\n", id, cacheBean.method4test(id));
			Thread.sleep(1000);
		}
	}
}
[&#47;java]</p>
