---
layout: post
status: publish
published: true
title: Django I18N例子
author:
  display_name: D
  login: D
  email: donilan.word@gmail.com
  url: ''
author_login: D
author_email: donilan.word@gmail.com
wordpress_id: 303
wordpress_url: http://blog.sincerad.com/?p=303
date: '2013-01-22 10:08:00 +0800'
date_gmt: '2013-01-22 10:08:00 +0800'
categories:
- Python
- django
tags:
- Python
- django
- i18n
comments: []
---
<p>今天被Django的i18n折磨了一天了，没想到最后还是路径的问题。废话不说，本来打算写日志，但后来想着想着就直接写成脚本了。<br />
保存以下脚本为 i18n-test.sh，然后运行就可以。(ps:只在ubuntu 下测试过.)<br />
[bash]<br />
#!&#47;usr&#47;bin&#47;env sh</p>
<p>PROJECT_NAME=i18ntest<br />
SETTINGS_FILE=$PROJECT_NAME&#47;settings.py<br />
URLS_FILE=$PROJECT_NAME&#47;urls.py<br />
PROJECT_HOME=`pwd`&#47;$PROJECT_NAME<br />
LANGUAGE=zh_CN</p>
<p>if [ -d $PROJECT_NAME ]<br />
then<br />
    read -p "Do you want to delete $PROJECT_NAME?" yn<br />
    case $yn in<br />
	[yY]* ) rm $PROJECT_NAME -rf;;<br />
	* ) exit 0;;<br />
    esac<br />
fi</p>
<p>## Create project<br />
django-admin.py startproject $PROJECT_NAME</p>
<p>## Enter project dir<br />
cd $PROJECT_NAME</p>
<p>## Create an app and add to settings file.<br />
django-admin.py startapp app<br />
sed -i "&#47;'django.contrib.admindocs'&#47;a\	'app'," $SETTINGS_FILE</p>
<p>## Add sqlite3 support for session use.<br />
## 增加数据库配置，使用sqlite3,数据库文件名为test.db<br />
sed -i -e "s&#47;django.db.backends.&#47;&sqlite3&#47;g " \<br />
    -e "s&#47;'NAME':\s*'&#47;&test.db&#47;g" $SETTINGS_FILE</p>
<p>## Add locale middleware for i18n.<br />
## 加入i18n的middleware，一定要在Session middleware之后<br />
sed -i "&#47;SessionMiddleware&#47;a\	'django.middleware.locale.LocaleMiddleware'," \<br />
    $SETTINGS_FILE</p>
<p>## Add url pattern for app view name index.<br />
sed -i "&#47;admin.site.urls&#47;a\    url(r'^$', 'app.views.index')," $URLS_FILE</p>
<p>## Enter app dir to make locale files.<br />
cd app</p>
<p>## First add a view.<br />
TMP=`cat <<EOF<br />
from django.utils.translation import ugettext as _<br />
from django.http import HttpResponse</p>
<p>def index(request):<br />
    return HttpResponse(_('Hello world!'))<br />
EOF`<br />
echo "$TMP" >> views.py</p>
<p>## Make locale file<br />
mkdir locale<br />
django-admin.py makemessages -l $LANGUAGE<br />
sed -i -e '&#47;Hello world&#47;{n;s&#47;""&#47;"Hello Chinese!"&#47;;}' \<br />
    locale&#47;$LANGUAGE&#47;LC_MESSAGES&#47;django.po<br />
django-admin.py compilemessages</p>
<p>## Run app server<br />
cd $PROJECT_HOME<br />
yes 'no' | python manage.py syncdb<br />
python manage.py runserver</p>
<p>[&#47;bash]</p>
